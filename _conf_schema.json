{
  "enabled": {
    "type": "bool",
    "description": "是否启用每日自动推送",
    "default": false,
    "obvious_hint": true
  },
  "schedule_time": {
    "type": "string",
    "description": "每日生成时间（HH:MM）",
    "default": "09:00",
    "hint": "例如：09:00"
  },
  "output_format": {
    "type": "string",
    "description": "输出格式",
    "default": "markdown",
    "options": ["markdown"]
  },
  "news_group_mode": {
    "type": "string",
    "description": "消息组模式（新）",
    "default": "group",
    "options": ["source", "group"],
    "hint": "source=按来源输出；group=按动态标签分组（Map→Shuffle→Reduce→Feedback）"
  },
  "news_group_router_provider_id": {
    "type": "string",
    "description": "消息组分类器 Provider（可选）",
    "_special": "select_provider",
    "default": "",
    "hint": "用于标签分类（建议用便宜模型）；留空则复用主 Agent provider 链"
  },
  "news_group_writeback_tags": {
    "type": "bool",
    "description": "自动写回新标签到标签库",
    "default": true
  },
  "news_group_promote_min_count": {
    "type": "int",
    "description": "新标签写回最小命中次数",
    "default": 2
  },
  "delivery_mode": {
    "type": "string",
    "description": "发送方式",
    "default": "html_image",
    "options": ["html_image", "plain"],
    "hint": "html_image 使用 AstrBot 的网页渲染服务生成图片发送，可规避部分 markdown 渲染插件输出空白的问题"
  },
  "render_template_name": {
    "type": "string",
    "description": "渲染模板",
    "default": "chenyu_style",
    "options": ["daily_news", "chenyu_style"],
    "hint": "daily_news=默认模板；chenyu_style=沉玉谷风格（chenyu-style.html）"
  },
  "max_sources_per_day": {
    "type": "int",
    "description": "每天最多处理多少个来源",
    "default": 3
  },
  "render_page_chars": {
    "type": "int",
    "description": "网页渲染每页最大字符数（过长会自动分页）",
    "default": 2600
  },
  "render_max_pages": {
    "type": "int",
    "description": "网页渲染最多生成多少页图片",
    "default": 4
  },
  "render_retries": {
    "type": "int",
    "description": "渲染失败重试次数（html_render / t2i）",
    "default": 2
  },
  "render_poll_timeout_s": {
    "type": "float",
    "description": "渲染产物轮询等待超时（秒）",
    "default": 6.0,
    "hint": "某些渲染服务会先写很小的占位文件；轮询可等待图片真正落盘"
  },
  "render_poll_interval_ms": {
    "type": "int",
    "description": "渲染产物轮询间隔（毫秒）",
    "default": 200
  },
  "render_playwright_fallback": {
    "type": "bool",
    "description": "渲染服务掉线时，使用本地 Playwright 截图兜底",
    "default": true
  },
  "render_playwright_timeout_ms": {
    "type": "int",
    "description": "本地 Playwright 截图超时（毫秒）",
    "default": 20000
  },
  "render_img_float_enabled": {
    "type": "bool",
    "description": "是否将窄图优先与文字并排（浮动排版）",
    "default": true
  },
  "preferred_source_types": {
    "type": "list",
    "description": "优先处理的来源类型",
    "default": ["wechat"],
    "hint": "例如：[\"wechat\", \"miyoushe\", \"github\"]",
    "options": ["wechat", "miyoushe", "github", "twitter", "plugin_registry"]
  },
  "github_enabled": {
    "type": "bool",
    "description": "启用 GitHub 信息源（读取近 N 小时 release/commit/pr）",
    "default": false,
    "obvious_hint": true
  },
  "github_repos": {
    "type": "list",
    "description": "GitHub 仓库列表（兼容字段：推荐改用 news_sources 模板列表）",
    "default": [],
    "hint": "例如：[\"openai/openai-python\", \"https://github.com/astrbot/astrbot\"]",
    "invisible": true
  },
  "github_token": {
    "type": "string",
    "description": "GitHub Token（推荐填写，避免限额/用于私有仓库）",
    "default": "",
    "hint": "建议使用 Fine-grained token：至少拥有 repo 读取权限"
  },
  "github_since_hours": {
    "type": "int",
    "description": "抓取近多少小时内的更新（release/commit/pr）",
    "default": 30
  },
  "github_max_releases": {
    "type": "int",
    "description": "每个仓库最多展示多少条 Release 更新（近 N 小时）",
    "default": 3
  },
  "github_max_commits": {
    "type": "int",
    "description": "每个仓库最多展示多少条 Commit 更新（近 N 小时）",
    "default": 6
  },
  "github_max_prs": {
    "type": "int",
    "description": "每个仓库最多展示多少条 PR 更新（近 N 小时）",
    "default": 6
  },
  "twitter_enabled": {
    "type": "bool",
    "description": "是否启用 X/Twitter 信息源（需要 Playwright + 代理）",
    "default": false
  },
  "twitter_targets": {
    "type": "list",
    "description": "X/Twitter 主页列表（兼容字段：推荐改用 news_sources 模板列表）",
    "default": [],
    "invisible": true
  },
  "twitter_proxy": {
    "type": "string",
    "description": "X/Twitter 代理地址（支持 http/socks5，例如 http://127.0.0.1:7890 或 socks5://127.0.0.1:7890）",
    "default": ""
  },
  "twitter_max_tweets": {
    "type": "int",
    "description": "每个主页最多抓取推文数（忽略置顶）",
    "default": 3
  },
  "twitter_priority": {
    "type": "int",
    "description": "X/Twitter 信息源优先级（数值越大越先处理）",
    "default": 1
  },
  "news_sources": {
    "type": "template_list",
    "description": "新闻源列表（推荐，v4.10.4+）",
    "default": [],
    "hint": "使用模板添加不同类型来源；如仍在用 wechat_sources/miyoushe_sources/github_repos/twitter_targets 也会兼容读取。",
    "templates": {
      "wechat": {
        "name": "微信公众号",
        "hint": "填公众号文章链接（mp.weixin.qq.com）。可选设置抓取篇数/优先级/显示名称。",
        "items": {
          "name": {
            "type": "string",
            "description": "显示名称（可选）",
            "default": ""
          },
          "url": {
            "type": "string",
            "description": "文章链接",
            "default": ""
          },
          "priority": {
            "type": "int",
            "description": "优先级（数值越大越先处理）",
            "default": 1
          },
          "max_articles": {
            "type": "int",
            "description": "每次最多抓取文章数",
            "default": 3
          },
          "album_keyword": {
            "type": "string",
            "description": "专辑关键词（可选）",
            "default": ""
          }
        }
      },
      "miyoushe": {
        "name": "米游社",
        "hint": "填用户帖子列表链接（miyoushe.com/.../postList?id=...）。",
        "items": {
          "name": {
            "type": "string",
            "description": "显示名称（可选）",
            "default": ""
          },
          "url": {
            "type": "string",
            "description": "帖子列表链接",
            "default": ""
          },
          "priority": {
            "type": "int",
            "description": "优先级（数值越大越先处理）",
            "default": 1
          },
          "max_articles": {
            "type": "int",
            "description": "每次最多抓取帖子数",
            "default": 3
          }
        }
      },
      "github": {
        "name": "GitHub",
        "hint": "填 owner/repo 或 https://github.com/owner/repo；需要 token 时请在 github_token 配置。",
        "items": {
          "name": {
            "type": "string",
            "description": "显示名称（可选）",
            "default": ""
          },
          "repo": {
            "type": "string",
            "description": "仓库（owner/repo 或 URL）",
            "default": ""
          },
          "priority": {
            "type": "int",
            "description": "优先级（数值越大越先处理）",
            "default": 1
          }
        }
      },
      "twitter": {
        "name": "X/Twitter",
        "hint": "填主页链接 https://x.com/<user> 或 https://twitter.com/<user>（抓取需要 Playwright，可配 twitter_proxy）。",
        "items": {
          "name": {
            "type": "string",
            "description": "显示名称（可选）",
            "default": ""
          },
          "url": {
            "type": "string",
            "description": "主页链接",
            "default": ""
          },
          "priority": {
            "type": "int",
            "description": "优先级（数值越大越先处理）",
            "default": 1
          },
          "max_articles": {
            "type": "int",
            "description": "每次最多抓取推文数（忽略置顶）",
            "default": 3
          }
        }
      },
      "plugin_registry_official": {
        "name": "插件源（官方）",
        "hint": "读取 AstrBot 的官方插件索引（data/plugins.json），抓取最近 27 小时新增/活跃的插件并用 GitHub API 校验仓库 created_at/pushed_at。",
        "items": {
          "name": {
            "type": "string",
            "description": "显示名称（可选）",
            "default": ""
          },
          "since_hours": {
            "type": "int",
            "description": "时间窗口（小时）",
            "default": 27
          },
          "max_plugins": {
            "type": "int",
            "description": "最多收集多少个插件",
            "default": 20
          }
        }
      },
      "plugin_registry_custom": {
        "name": "插件源（第三方）",
        "hint": "读取第三方插件索引 JSON（结构同 plugins.json）。这里建议只填文件名（与官方 plugins.json 位于同一目录）。抓取最近 27 小时新增/活跃的插件并用 GitHub API 校验仓库 created_at/pushed_at。",
        "items": {
          "name": {
            "type": "string",
            "description": "显示名称（可选）",
            "default": ""
          },
          "path": {
            "type": "string",
            "description": "第三方插件索引文件名（JSON）",
            "default": ""
          },
          "since_hours": {
            "type": "int",
            "description": "时间窗口（小时）",
            "default": 27
          },
          "max_plugins": {
            "type": "int",
            "description": "最多收集多少个插件",
            "default": 20
          }
        }
      }
    }
  },
  "llm_timeout_s": {
    "type": "int",
    "description": "LLM 请求超时时间（秒）",
    "default": 180
  },
  "llm_write_timeout_s": {
    "type": "int",
    "description": "LLM 写作阶段超时（秒）",
    "default": 360,
    "hint": "写作输入更长，建议比 llm_timeout_s 大"
  },
  "llm_merge_timeout_s": {
    "type": "int",
    "description": "LLM 汇总阶段超时（秒）",
    "default": 240
  },
  "llm_max_retries": {
    "type": "int",
    "description": "LLM 超时/失败重试次数",
    "default": 1
  },
  "main_agent_provider_id": {
    "type": "string",
    "description": "主Agent 使用的 Provider（用于主 Agent 决策/汇总）",
    "_special": "select_provider",
    "default": ""
  },
  "main_agent_fallback_provider_ids": {
    "type": "list",
    "description": "主 Agent 备用 Provider 列表（主 Provider 次数/限额耗尽时自动轮询）",
    "default": [],
    "hint": "例如：[\"providerA\", \"providerB\"]（会按顺序尝试，成功即停止）"
  },
  "main_agent_fallback_provider_id_1": {
    "type": "string",
    "description": "主 Agent 备用 Provider 1（优先级最高）",
    "_special": "select_provider",
    "default": ""
  },
  "main_agent_fallback_provider_id_2": {
    "type": "string",
    "description": "主 Agent 备用 Provider 2",
    "_special": "select_provider",
    "default": ""
  },
  "main_agent_fallback_provider_id_3": {
    "type": "string",
    "description": "主 Agent 备用 Provider 3",
    "_special": "select_provider",
    "default": ""
  },
  "image_plan_enabled": {
    "type": "bool",
    "description": "启用主 Agent 图片数量规划（为图片排版 Agent 提供优先约束）",
    "default": true
  },
  "image_label_enabled": {
    "type": "bool",
    "description": "启用图片打标（先用 VLM 为每个图片 URL 生成<=30字标签，供排版模型选择）",
    "default": false,
    "hint": "开启后会优先使用 image_catalog（标签表）而不是把大量候选图片直接喂给排版模型",
    "obvious_hint": true
  },
  "image_label_provider_id": {
    "type": "string",
    "description": "图片打标使用的 Provider（需要支持图片输入）",
    "_special": "select_provider",
    "default": ""
  },
  "image_label_max_images_total": {
    "type": "int",
    "description": "最多对多少张候选图进行打标（过多会显著增加耗时）",
    "default": 24
  },
  "image_label_batch_size": {
    "type": "int",
    "description": "每次 VLM 调用同时打标的图片数量（建议 2）",
    "default": 2
  },
  "image_label_concurrency": {
    "type": "int",
    "description": "图片打标并发数（下载+VLM 调用）",
    "default": 4
  },
  "image_label_force_refresh": {
    "type": "bool",
    "description": "强制重新打标（忽略缓存）",
    "default": false
  },
  "image_label_llm_max_retries": {
    "type": "int",
    "description": "图片打标调用 LLM 的重试次数（并发下更容易触发限额）",
    "default": 2
  },
  "image_label_llm_retry_base_s": {
    "type": "float",
    "description": "图片打标 LLM 重试基础退避秒数（指数退避）",
    "default": 1.0
  },
  "image_label_llm_retry_max_s": {
    "type": "float",
    "description": "图片打标 LLM 单次退避最大秒数",
    "default": 12.0
  },
  "image_layout_enabled": {
    "type": "bool",
    "description": "启用图片排版 Agent（从消息源提取的图片 URL 中选图并插入日报）",
    "default": false,
    "hint": "需要 AstrBot >= v4.0.0，并选择一个支持图片输入的 Provider",
    "obvious_hint": true
  },
  "image_layout_provider_id": {
    "type": "string",
    "description": "图片排版 Agent 使用的 Provider",
    "_special": "select_provider",
    "default": ""
  },
  "image_layout_max_images_total": {
    "type": "int",
    "description": "图片排版 Agent 最多插入图片数（总计）",
    "default": 6
  },
  "image_layout_max_images_per_source": {
    "type": "int",
    "description": "图片排版 Agent 单个来源最多插入图片数",
    "default": 3
  },
  "image_layout_sources": {
    "type": "list",
    "description": "仅从指定来源选图（空列表=全部来源）",
    "default": [],
    "hint": "例如：[\"来源1\", \"来源2\"]"
  },
  "image_layout_pass_images_to_model": {
    "type": "bool",
    "description": "将候选图片作为 vision 输入传给模型（需要所选 Provider 支持图片）",
    "default": true
  },
  "image_layout_max_images_to_model": {
    "type": "int",
    "description": "最多传给模型的图片数（vision 输入）",
    "default": 6
  },
  "image_layout_preview_enabled": {
    "type": "bool",
    "description": "为图片排版 Agent 生成一张纵向拼接预览图",
    "default": false
  },
  "image_layout_preview_max_images": {
    "type": "int",
    "description": "参与拼接预览的最大图片数",
    "default": 6
  },
  "image_layout_preview_max_width": {
    "type": "int",
    "description": "预览图最大宽度（像素）",
    "default": 1080
  },
  "image_layout_preview_gap": {
    "type": "int",
    "description": "预览图中图片之间的间距（像素）",
    "default": 8
  },
  "image_layout_request_max_requests": {
    "type": "int",
    "description": "排版 Agent 最多允许请求“查看候选图细节”的次数（request_image_urls）",
    "default": 1,
    "hint": "增大可减少错位/错图，但会增加额外的 LLM 调用次数"
  },
  "image_layout_request_max_images": {
    "type": "int",
    "description": "每次 request_image_urls 最多合成多少张候选图预览",
    "default": 6
  },
  "image_layout_tool_enabled": {
    "type": "bool",
    "description": "启用“工具驱动的排版编辑”：先给 AI 文字稿，再让 AI 通过 tools 插图/改文并反复渲染校验",
    "default": true,
    "hint": "需要 AstrBot >= 4.5.7（tool_loop_agent），且所选 Provider 支持工具调用"
  },
  "image_layout_tool_rounds": {
    "type": "int",
    "description": "工具驱动排版最多迭代轮数（每轮会渲染预览并允许调用 tools）",
    "default": 2
  },
  "image_layout_tool_max_steps": {
    "type": "int",
    "description": "每轮 tool-loop 最大工具调用步数",
    "default": 25
  },
  "image_layout_shuffle_candidates": {
    "type": "bool",
    "description": "发送给排版 Agent 前打乱候选图（减少每次都选同一张）",
    "default": true
  },
  "image_layout_shuffle_seed": {
    "type": "string",
    "description": "候选图打乱用的种子（可选，留空=随机）",
    "default": ""
  },
  "image_layout_refine_enabled": {
    "type": "bool",
    "description": "启用“渲染预览回喂”的迭代排版（直到差不多）",
    "default": false,
    "hint": "需要本地 Playwright 可用；会增加额外的 LLM 调用次数"
  },
  "image_layout_refine_rounds": {
    "type": "int",
    "description": "最多迭代轮数",
    "default": 2
  },
  "image_layout_refine_max_requests": {
    "type": "int",
    "description": "最多允许请求“查看原图细节”的次数",
    "default": 2
  },
  "image_layout_refine_request_max_images": {
    "type": "int",
    "description": "每次请求最多合成几张原图预览",
    "default": 6
  },
  "image_layout_refine_preview_page_chars": {
    "type": "int",
    "description": "迭代预览渲染时每页最大字符数",
    "default": 2400
  },
  "image_layout_refine_preview_pages": {
    "type": "int",
    "description": "迭代预览渲染页数（建议 1）",
    "default": 1
  },
  "target_sessions": {
    "type": "list",
    "description": "推送目标会话 unified_msg_origin 列表",
    "default": [],
    "hint": "可用 /news_subscribe 将当前会话加入"
  },
  "admin_sessions": {
    "type": "list",
    "description": "错误通知目标会话 unified_msg_origin 列表",
    "default": []
  },
  "wechat_sources": {
    "type": "list",
    "description": "微信公众号新闻源（兼容字段：推荐改用 news_sources 模板列表）",
    "default": ["https://mp.weixin.qq.com/s/K1FGe-TiAk52B8lD6Kg8Mw"],
    "hint": "每一项填一个链接：公众号文章（mp.weixin.qq.com）。支持一次粘贴多条链接（空白分隔）。",
    "invisible": true
  },
  "miyoushe_sources": {
    "type": "list",
    "description": "米游社新闻源（兼容字段：推荐改用 news_sources 模板列表）",
    "default": ["https://www.miyoushe.com/ys/accountCenter/postList?id=75276539"],
    "hint": "每一项填一个链接：米游社用户帖子列表（miyoushe.com/.../accountCenter/postList?id=...）。支持一次粘贴多条链接（空白分隔）。",
    "invisible": true
  },
  "last_run_schedule_time": {
    "type": "string",
    "description": "内部字段：上次运行时的 schedule_time（用于 schedule_time 变更后的补跑）",
    "default": "",
    "invisible": true
  },
  "last_run_date": {
    "type": "string",
    "description": "内部字段：上次运行日期 YYYY-MM-DD",
    "default": "",
    "invisible": true
  }
}
